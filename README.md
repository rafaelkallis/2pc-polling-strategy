## Two Phase Commit Recovery Polling Strategy
### by [Rafael Kallis](http://rafaelkallis.com), [Elias Bernhaut](https://github.com/alpox)
[![Build Status](https://travis-ci.org/rafaelkallis/2pc-polling-strategy.svg?branch=master)](https://travis-ci.org/rafaelkallis/2pc-polling-strategy)
___
 
 ### Problem Definition:

 Unlike a transaction on a local database, a distributed transaction involves altering data on multiple databases. Consequently, distributed transaction processing is more complicated, because the database must coordinate the committing or rolling back of the changes in a transaction as a self-contained unit. In other words, the entire transaction commits, or the entire transaction rolls back.

 The database ensures the integrity of data in a distributed transaction using the two-phase commit mechanism. In the prepare phase, the coordinator in the transaction asks the subordinates to promise to commit or roll back the transaction. If all subordinates are able to commit the transaction, the transaction stages in the commit phase, otherwise it stages in the abort phase. During the commit phase, the coordinator asks all subordinates to commit the transaction. During the abort phase, all subordinates are asked to roll back.


// write more stuff

### Coordinator State Chart

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="533px" height="433px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/602.2.14 (KHTML, like Gecko) Version/10.0.1 Safari/602.2.14&quot; version=&quot;6.0.1.9&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;Page-1&quot;&gt;7Vpdd9o4EP01fqTHkjA4j0Cd3Z7dlByg2+ZRwYrx1lgcIwL0169kS7YlmY80prTp8pCDRtJImpl7pZngoNFy90eGV4s7GpLEgW64c9B7B8Ibz+V/hWBfCHquXwiiLA4LEagE0/gbkUI5L9rEIVlrAxmlCYtXunBO05TMmSbDWUa3+rAnmuirrnBELMF0jhNb+jkO2aKQ+upYQv4niaOFWhm4sucRz79GGd2kcj0Hoqf8U3QvsdIlx68XOKTbmggFDhpllLLi23I3IokwrTJbMe/2QG+574yk7JwJvWLCM042RO043xfbK1vkpyFiPHDQcLuIGZmu8Fz0brnzuWzBlonsXrOMfiUjmtAsn40Qcl0w4D1yIZIxsju4WVCagEcWoUvCsj0fIif40mh7vbmtPOQhKVvUvNNVQiyjIio1V5bhX6Rxmg0FLUPdT4L7wSRwYC/hCw3D+Jl/jcTXwefBhxkf/M94VnZz/bURlpH5Yjy2yZUNXOJPWhh0bRMD2GBivwULo9OhSNJwINDNW/MEr9fx/IRx3PxTGoeEFuwN0/Dl6CabE83pDGcRUcHUbMB6DDbYR8kykmAWP+ubaDKaXOGexnx7lX/6un9Qz7B7sXk5qw57QxGChiJgKCqObCnKfVge+yy3epZbH4KpI9a/bYDONPjIh7ij8d2dgNBZ2OHxzvQ4yMg6/oYf8wHC+ytxjvxk3tDx3nMJTuIoFWHE3U94sAwFbmJ+AQxkxzIOQzF/mOBHkgxLWq8FlyT2I8iT15PcScX69bBDRxHZcd+BnlK315S/MpY6nq61Y2igT09r8lrng/6R68TVnUZ2MfsixO882XpQPU2w58LbOFGT/yWM7eU7Am8Y5SKasQWNaIqTvyldXYghujZDgF6zR8/217mECW4saA1Gfx2EVo6s3wBQRcwdRVTpNyP2XwspE6jeBSDVtZyuk2XDOySPil/4GVJeez/iGQJ82yqcFKaymdJUmOdtsVj/iiym/Pg/i+le8k+xmAv7/VZoSz1zFWuhC7BW33bycDx5S6SFet71SMu3zGtb6fq504GL+cfkTsA7kfKcmztB17idzCSsvdwJAMuvH8clNeKliO/0cb3KnXQol9KA9qY58yRlAl+RW6upVPdGU9rxL0CgwL4mrwLxOp7hVfFs1EKA+do+G89m0atnKGoPz9DG83Q2EOg8Xg4xSo1vGsTAbY6qGoq7SE/fWkKxfn93oEHr7cAY2aitZRfVaz+opMP5JnsuC/CnM49fJ+9oqJ4cqK++zLf8vHhfGyDj/fy3AfKPUoY5Hvq+ERfFDr47Suwkf/bhLhh/qpji1OU/CWaTB+e3qqSC46VUnjF1jZInbIU4lBoVPP1L8IZdRjcj4lAEvOT91zYXAYuL+Im/1BsPirF+XpZqqI6cLDFCD+ovzQ74rmB7KZN5L2Qyczz04WEmsyMf6KGvmu2Gvv0/6vxV9FNWAeCNbs+ue7kqAG9WPxQoDFv9GAMF/wE=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g transform="translate(0.5,0.5)"><rect x="1" y="1" width="530" height="430" rx="64.5" ry="64.5" fill="#ffffff" stroke="#33001a" pointer-events="none"/><ellipse cx="191" cy="101" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(154.5,87.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="73" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 74px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">PREPARE<div>AWAIT VOTE</div></div></div></foreignObject><text x="37" y="19" fill="#000000" text-anchor="middle" font-size="12px">PREPARE&lt;div&gt;AWAIT VOTE&lt;/div&gt;</text></switch></g><path d="M 191 141 L 191 184.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 191 189.88 L 187.5 182.88 L 191 184.63 L 194.5 182.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(98.5,148.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="85" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">YES /<div>SEND COMMIT</div></div></div></foreignObject><text x="43" y="19" fill="#000000" text-anchor="middle" font-size="12px">YES /&lt;div&gt;SEND COMMIT&lt;/div&gt;</text></switch></g><path d="M 191 271 L 236.18 321.83" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 239.67 325.75 L 232.4 322.85 L 236.18 321.83 L 237.63 318.2 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(175.5,298.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="31" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">ACK /<div>END</div></div></div></foreignObject><text x="16" y="19" fill="#000000" text-anchor="middle" font-size="12px">[Not supported by viewer]</text></switch></g><ellipse cx="191" cy="231" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(158.5,217.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="65" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">COMMIT<div>AWAIT ACK</div></div></div></foreignObject><text x="33" y="19" fill="#000000" text-anchor="middle" font-size="12px">COMMIT&lt;div&gt;AWAIT ACK&lt;/div&gt;</text></switch></g><path d="M 346 271 L 304.22 321.14" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 300.85 325.17 L 302.65 317.56 L 304.22 321.14 L 308.02 322.04 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(330.5,297.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="31" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">ACK /<div>END</div></div></div></foreignObject><text x="16" y="19" fill="#000000" text-anchor="middle" font-size="12px">[Not supported by viewer]</text></switch></g><ellipse cx="346" cy="231" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(313.5,217.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="65" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">ABORT<div>AWAIT ACK</div></div></div></foreignObject><text x="33" y="19" fill="#000000" text-anchor="middle" font-size="12px">ABORT&lt;div&gt;AWAIT ACK&lt;/div&gt;</text></switch></g><path d="M 228.36 132.3 L 303.79 195.59" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 307.81 198.97 L 300.2 197.15 L 303.79 195.59 L 304.7 191.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(271.5,138.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">TIMEOUT &or; NO / <div>SEND ABORT</div></div></div></foreignObject><text x="39" y="19" fill="#000000" text-anchor="middle" font-size="12px">NO /&amp;nbsp;&lt;div&gt;SEND ABORT&lt;/div&gt;</text></switch></g><path d="M 91 36 L 142.7 69.61" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 147.1 72.47 L 139.33 71.59 L 142.7 69.61 L 143.14 65.72 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(114.5,17.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="93" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">START /<div>SEND PREPARE</div></div></div></foreignObject><text x="47" y="19" fill="#000000" text-anchor="middle" font-size="12px">START /&lt;div&gt;SEND PREPARE&lt;/div&gt;</text></switch></g><path d="M 149 259 Q 71 259 71 234 Q 71 209 134.52 209" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 139.77 209 L 132.77 212.5 L 134.52 209 L 132.77 205.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(25.5,258.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">TIMEOUT / <div>RETRY COMMIT</div></div></div></foreignObject><text x="46" y="19" fill="#000000" text-anchor="middle" font-size="12px">TIMEOUT /&amp;nbsp;&lt;div&gt;RETRY COMMIT&lt;/div&gt;</text></switch></g><path d="M 388 259 Q 471 259 471 231 Q 471 203 394.37 203" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 389.12 203 L 396.12 199.5 L 394.37 203 L 396.12 206.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(431.5,258.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="24" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">TIMEOUT /<div>RETRY ABORT</div></div></div></foreignObject><text x="39" y="18" fill="#000000" text-anchor="middle" font-size="11px">TIMEOUT /&lt;div&gt;RETRY ABORT&lt;/div&gt;</text></switch></g><ellipse cx="271" cy="361" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(258.5,354.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="25" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 26px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">END</div></div></foreignObject><text x="13" y="12" fill="#000000" text-anchor="middle" font-size="12px">END</text></switch></g></g></svg>

### Subordinate State Chart

<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="513px" height="473px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/602.2.14 (KHTML, like Gecko) Version/10.0.1 Safari/602.2.14&quot; version=&quot;6.0.1.9&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;Page-1&quot;&gt;5Vpbd6I6FP41PraLEG4+omU6rmm1Sz1nTh9RUmQGiQux6vz6CRAuCRdBse1Z+qCws7MTdr797Z1gDw7Xh0ff3KyesYXcnihYhx586IliXxbIdyg4xgJF0GKB7TtWLAKZYOb8QVRI+9k7x0JbRjHA2A2cDStcYs9Dy4CRmb6P96zaG3bZUTemjQqC2dJ0i9KfjhWsYqmWPFYo/44ce5WMDATasjCXv20f7zw6Xk+Eb9Enbl6biS2qv12ZFt7nRNDowaGPcRBfrQ9D5IauTdwW9/tW0ZrO20de0KSDGHd4N90dSmYczSs4Jr6IngaF+qAHB/uVE6DZxlyGrXuy+ES2CtYubd4GPv6NhtjFftQbQigIQCctdCDkB+hQOVmQuoAgC+E1CvwjUaEdIHUaBZVGb/fZCskJgFa51ZFUKjQpKuzUcuYZckGdU+EooeAYZBHM0FsPe+RnkPlKYP2CDk7wX+76Nbn2LD3EK7lduuZ26yxj4TfHTbr+QkFwpCFi7gJMRNgPVtjGnuk+Ybypcr0QfVLXh9Otdzx5Orzzl1QL0rgzfRtRLa18eXzkmoHzzlq/xNmwgMrhd2P4YzR+7ImKSyYzsJx3cmmHl/pg9DSavyYtxHausUR/PiGmh5Pn59G8qg+/0K5LiAd9MvpTcqTwB1IR/0Aswb/WAfyl0zxRCuU656T4TIJD4IKjArdNQNrKsSrr2DTW88RS4le5xq90sBfskDlUjgQVzkT8aLRXnrY5Q1DkDAHOUOyQgqFomVMPNFp5ubDy+uDJIBImjoRwiGKszYwx6SG8GjPy/e9kbjSMOBIlAYseH22dP+YiUghxsgkfLXpYedCTH4jEdB3bC8FHlh0RiA3CaHNITtdpw9qxrLD/wDUXyB2kmToHSZqra+KVVhx0Jlkiz8NNqoXbnXAPlMTckTHemEjLUXHHwUthDeC3ty26FA5KTX1QkfP4sP7MnJfnDq3IHaB/KXnAOlZoyrZqMf/Vx1naPJ/q45k+nI8m48YJkfya6zCTeYvtJqey8PlOJ03ReNeHP24i0JWTgZ5mTgqPu64iXebMwivEulak/p96VjUx+JtMH0ZjfT6ZNsbKszGb6Y9NM8LXrMHS6P+IGgyAklQ8mc6Nhy/qLSiw3pI+smIFDba2l5es/H7uzLRzhmvVe6hIqqRJkgT7ogBZXAJwL/aVvqKpmihpIlALju+mogXyiUK0aUUrclgR+dK4u4oWFLeX/4z5ojbLtaW5sZjzxpNbKnHj6KpNfRpgMdlN5pNZoyTx9a+Q+cQKqq0swJLWM+uvinqrVWV1w6i7EFMq4DB1DUiBqx6hVOSdfJKBbXMM4LY2AMjXyiJVI7XOIvwZmcIZ6jCLFA9GXqbGiz41qndp4SFmGMTJiaXQ/izyfx7Ap49GJMjumLpJG/x+SeQw2k2I9wuQiNf2y1bofPn2oRV6GQHmXqlkBz5GJm33hiWq1D0yrbQhvIla7uWPOola7vz39PVZBU+feBUDSugcVKxsu0Ahj28ecwqUPCrjSFI4wMhiLSEX9DWBg0g8g7MLtWJWrS/UbuyESjxdp8uaynKj2gnjStdg2KSIaUUZTAC2Oq1m+EP4JP44kzL6JZTR/wzKAKAdZRT0u6aMYuHW7C3WzXAGPMUZEHD1VDeUccfvHM7hDHKb/X0mVs/+ogSNvw==&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g transform="translate(0.5,0.5)"><rect x="1" y="1" width="510" height="470" rx="70.5" ry="70.5" fill="#ffffff" stroke="#33001a" pointer-events="none"/><path d="M 283 129 L 259.31 186.54" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 257.31 191.39 L 256.74 183.59 L 259.31 186.54 L 263.21 186.25 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="241" cy="101" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(206.5,80.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="68" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 69px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">CHECKING<div>ABILITY</div><div>TO COMMIT</div></div></div></foreignObject><text x="34" y="26" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 199 129 L 222.69 186.54" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 224.69 191.39 L 218.79 186.25 L 222.69 186.54 L 225.26 183.59 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(86.5,148.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="109" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">ABLE TO COMMIT /<div>SEND YES VOTE</div></div></div></foreignObject><text x="55" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">ABLE TO COMMIT /&lt;div&gt;SEND YES VOTE&lt;/div&gt;</text></switch></g><path d="M 199 259 L 186.85 354.82" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 186.19 360.03 L 183.6 352.65 L 186.85 354.82 L 190.55 353.53 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(48.5,263.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="138" height="54" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">COMMIT /<div>COMMIT TRANSACTION</div><div>&and;<br /></div><div>SEND ACK</div></div></div></foreignObject><text x="69" y="33" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><ellipse cx="241" cy="231" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(196.5,210.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="89" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 90px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">AWAIT<div>COORDINATOR</div><div>MESSAGE</div></div></div></foreignObject><text x="45" y="26" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><ellipse cx="331" cy="401" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(301.5,394.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="58" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 59px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">ABORTED</div></div></foreignObject><text x="29" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">ABORTED</text></switch></g><path d="M 283 259 L 315.77 355.95" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 317.45 360.92 L 311.89 355.41 L 315.77 355.95 L 318.53 353.17 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(288.5,148.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="126" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">UNABLE TO COMMT / <div>SEND NO VOTE</div></div></div></foreignObject><text x="63" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">UNABLE TO COMMT /&amp;nbsp;&lt;div&gt;SEND NO VOTE&lt;/div&gt;</text></switch></g><g transform="translate(306.5,264.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="130" height="54" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">ABORT /<div>ABORT TRANSACTION</div><div>&and;<br /><div>SEND ACK</div></div></div></div></foreignObject><text x="65" y="33" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 141 36 L 192.7 69.61" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 197.1 72.47 L 189.33 71.59 L 192.7 69.61 L 193.14 65.72 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(159.5,17.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="162" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">PREPARE /<div>CHECK ABILITY TO COMMIT</div></div></div></foreignObject><text x="81" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">PREPARE /&lt;div&gt;CHECK ABILITY TO COMMIT&lt;/div&gt;</text></switch></g><ellipse cx="181" cy="401" rx="60" ry="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><g transform="translate(148.5,394.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="65" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">COMMITED</div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">COMMITED</text></switch></g><path d="M 373 373 Q 431 373 431 387 Q 431 401 397.37 401" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 392.12 401 L 399.12 397.5 L 397.37 401 L 399.12 404.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(435.5,367.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="61" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">ABORT /<div>SEND ACK</div></div></div></foreignObject><text x="31" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 139 373 Q 81 373 81 387 Q 81 401 114.63 401" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 119.88 401 L 112.88 404.5 L 114.63 401 L 112.88 397.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(15.5,367.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="61" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">COMMIT /<div>SEND ACK</div></div></div></foreignObject><text x="31" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>

We assume that each tranaction runs through a different instance of the above state chart. When the transaction starts, the coordinator sends *prepare* messages to all subordinates. The coordinator awaits all subordinates to respond with their votes. If all subordinates responded with a *yes* vote, the coordinator sends *commit* messages to all subordinates. If any subordinate responded to the *prepare* message with a *no* or a timeout has occured, the coordinator sends *abort* messages to all subordinates. After sending *commit* (*abort*) messages, the coordinator awaits all subordinates to respond with an *ack* message. If a timeout occurres while waiting, the coordinator retransmitts the *commit* (*abort*) message to the respective subordinate. The transaction ends when all subordinates have responded with an *ack* message to the coordinator's *commit* (*abort*) message.



// define constants & variables


<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="473px" height="363px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/602.2.14 (KHTML, like Gecko) Version/10.0.1 Safari/602.2.14&quot; version=&quot;6.0.1.9&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;Page-1&quot;&gt;7Vhdb9owFP01eZnUKYn5fIRAt2nrQIA27dEkl2DViSPHKbBfPztxArHphqrSqtt4iPCxr+2cc3x9wUFBsv/Acba9YxFQx3ejvYMmju8Pu658KuBQAT13UAExJ1EFeUdgSX6CBnVcXJAI8tZAwRgVJGuDIUtTCEULw5yzXXvYhtH2qhmOwQKWIaY2+p1EYluhg/q1FP4RSLytV/Zc3bPG4X3MWZHq9RwfbcpP1Z3gei49Pt/iiO1OIDR1UMAZE9W3ZB8AVdTWtFVxt4/0NvvmkIqLArpVxAOmBdRbLjcmDjUZ5euACvAcNN5tiYBlhkPVu5PqS2wrEqq7c8HZPQSMMl5GI4Rc1xvJHr0QcAH7R3frNRxIawFLQPCDHKID+po17apuv2rujhJ16iHbE3lQT4NY2yJuZj5SI79ods4z5VtEBYzxiKRYyFc1OZO6ZuprkdAvZAOUpLI1zoATuTAoaqiG50fsT9xKtwssQ3jTphRnOVmXq7oS4RAWPCcPsIC8OlQKZYVQKwXNYXGvLZTXbSs1cC2lmiPTUsp9BqWQpdSyWGup4L9SbaXQayrVs5SaL6bz0WJqqXTCrXpdIlP1iJI4ldiaCcES2QFpNFK5X2GUhffnqHPLT0MdRNY9cClxN+57t+/1WuQNLe5qOjlQLKTa7ZvqDHV6vTkjchvNYs3FeDDOVz1Fzgoego46zffGRGhoTDQ0JhKYxyB+M1E9kG02ObTGlGo3RF1kgL5lgB/TpaPurFv5/DqTj2+z1Vuwg3SDP/Rb3N543rX8YMrom6fxUj+YxvI7r+qHgX3Jzu7uPq0aS4zGs8XqDdhBZYfa3c2Zfans4Jv1zlOzg/+62WFouWEUfH4r4qOukQzsi/VKyQC5xhRPTQaoY0z0svLX6fNE/5AlCRHvmnSAZV2nmoYlZDkk2gUZV1UWPpZfmdpwudnu2OlOJIILwXQlpgKwthCFjTjjLMFUxZfLApCk8Uo1Jjed56nIhh0jI9u3yNmKzH+Ggsyzf+VkHNTe/27OO2Z9NbCT9fVIt3+w/As+Nzn3B/7VOJfN438qVSo6/m+Fpr8A&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g transform="translate(0.5,0.5)"><rect x="1" y="1" width="470" height="360" rx="54" ry="54" fill="#ffffff" stroke="#33001a" pointer-events="none"/><rect x="81" y="24" width="100" height="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><path d="M 131 64 L 131 324" fill="none" stroke="#33001a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(99.5,38.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="63" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 64px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Coordinator</div></div></foreignObject><text x="32" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Coordinator</text></switch></g><rect x="281" y="24" width="100" height="40" fill="#ffffff" stroke="#33001a" pointer-events="none"/><path d="M 331 64 L 331 324" fill="none" stroke="#33001a" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(298.5,38.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="65" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Subordinate</div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Subordinate</text></switch></g><path d="M 141 94 L 313.08 132.24" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 319.91 133.76 L 312.32 135.66 L 313.83 128.82 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(200.5,89.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="52" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">PREPARE</div></div></foreignObject><text x="26" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">PREPARE</text></switch></g><path d="M 321 144 L 148.92 182.24" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 142.09 183.76 L 148.17 178.82 L 149.68 185.66 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(184.5,139.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="81" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">YES / NO VOTE</div></div></foreignObject><text x="41" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">YES / NO VOTE</text></switch></g><path d="M 141 204 L 312.99 232.67" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 319.9 233.82 L 312.42 236.12 L 313.57 229.21 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(185.5,189.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="91" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">COMMIT / ABORT</div></div></foreignObject><text x="46" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">COMMIT / ABORT</text></switch></g><path d="M 321 245 L 148.92 283.24" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 142.09 284.76 L 148.17 279.82 L 149.68 286.66 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(218.5,240.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="23" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">ACK</div></div></foreignObject><text x="12" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">ACK</text></switch></g><g transform="translate(26.5,187.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="85" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">commit* / abort*</div></div></foreignObject><text x="43" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">commit* / abort*</text></switch></g><g transform="translate(342.5,131.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="88" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">prepare* / abort*</div></div></foreignObject><text x="44" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">prepare* / abort*</text></switch></g><g transform="translate(342.5,228.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="85" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">commit* / abort*</div></div></foreignObject><text x="43" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">commit* / abort*</text></switch></g></g></svg>
```
An * next to the record type means that the record is forced to stable storage.
```